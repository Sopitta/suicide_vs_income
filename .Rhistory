setwd("/m/home/home7/75/ranjitm1/unix/Downloads/bda/suicide_v_income")
install.packages(c("loo", "rstan", "shinystan"))
remove.packages("rstan")
if (file.exists(".RData")) file.remove(".RData")
Sys.setenv(DOWNLOAD_STATIC_LIBV8 = 1) # only necessary for Linux without the nodejs library / headers
install.packages("rstan", repos = "https://cloud.r-project.org/", dependencies = TRUE)
library(rstan)
library(shinystan)
library(loo)
#setwd("C:/Users/SopittaT/Desktop/Fall2020/BDA/Project/Data")
#setwd("~/Documents/work/bda/project")
setwd("/m/home/home7/75/ranjitm1/unix/Downloads/bda/suicide_v_income")
ukdata =read.csv('UKdata.csv');
usdata =read.csv('USdata.csv');
countrydata =read.csv('countrydata.csv')
#file_name = "suicides_v_income.stan"
file_name = "suicides_v_income_cov.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
model_hier
draws$sig_cov[1,1]
draws_hier$sig_cov[1,1]
draws_hier$`sig_cov[1,1]`
min(draws_hier$`sig_cov[1,1]`)
max(draws_hier$`sig_cov[1,1]`)
View(draws_hier)
draws_hier["385"]
draws_hier[385]
237-119
262-118
draws_hier[144]
draws_hier[144,2]
draws_hier[144,1:2]
draws_hier[244,1:2]
draws_hier[1:2,244]
draws_hier[244]
draws_hier[262]
262+9+93+22
draws_hier[386]
draws_hier[300]
draws_hier[262,1:5]
144+9+22+93
237-119
262-119
log_lik  <- data.matrix(draws_hier[144:267])
loo1 <- loo(log_lik)
loo1
######################
#file_name = "suicides_v_income.stan"
file_name = "suicides_v_income_cov2.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[144:267]) #for suicides_v_income_cov
loo2 <- loo(log_lik)
View(draws_hier)
267-144
272-123
model_hier
log_lik  <- data.matrix(draws_hier[149:272]) #for suicides_v_income_cov
loo2 <- loo(log_lik)
loo2
length(draws_hier[149])
length(data.array(draws_hier[149])
)
length(data.matrix(draws_hier[149]))
log_lik  <- data.matrix(draws_hier[149:272,2000:4000]) #for suicides_v_income_cov
data.matrix(draws_hier[149:272,2000:4000])
lenbgth(log_lik)
length(log_lik)
length(log_lik,1)
size(log_lik,1)
length(log_lik[:,2000:4000])
length(log_lik[,2000:4000])
length(log_lik[2000:4000,])
log_lik <- log_lik[2000:4000,]
loo2 <- loo(log_lik)
loo2
length(draws_hier)
View(draws_hier)
93+22+9
data.matrix(draws_hier[-123:length(draws_hier)])
log_lik  <- data.matrix(draws_hier[length(draws_hier)-124:length(draws_hier)-1]) #for suicides_v_income_cov
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-124):(length(draws_hier)-1)]) #for suicides_v_income_cov
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-124):(length(draws_hier)-1)]) #for suicides_v_income_cov
loo2 <- loo(log_lik)
loo2
min(log_lik)
max(log_lik)
plot(usdata$wagepercol, usdata$suicides100k); lines(mean(draws_hier$`theta2[1]`)+mean(draws_hier$`theta2[2]`)*usdata$wagepercol)
plot(usdata$wagepercol, usdata$suicides100k); lines(usdata$wagepercol, mean(draws_hier$`theta2[1]`)+mean(draws_hier$`theta2[2]`)*usdata$wagepercol)
plot(ukdata$wagepercol, ukdata$suicides100k); lines(ukdata$wagepercol, mean(draws_hier$`theta1[1]`)+mean(draws_hier$`theta1[2]`)*ukdata$wagepercol)
plot(countrydata$wagepercol, countrydata$suicides100k); lines(countrydata$wagepercol, mean(draws_hier$`theta3[1]`)+mean(draws_hier$`theta3[2]`)*countrydata$wagepercol)
plot(ukdata$wagepercol, ukdata$suicides100k); lines(ukdata$wagepercol, mean(draws_hier$`theta1[1]`)+mean(draws_hier$`theta1[2]`)*ukdata$wagepercol)
plot(usdata$wagepercol, usdata$suicides100k); lines(usdata$wagepercol, mean(draws_hier$`theta2[1]`)+mean(draws_hier$`theta2[2]`)*usdata$wagepercol)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-124):(length(draws_hier)-1)])
loo2 <- loo(log_lik)
loo2
length(draws_hier)
View(draws_hier)
mean(draws_hier$lp__)
mean(draws_hier[271])
mean(data.matrix(draws_hier[271]))
mean(data.matrix(draws_hier[271-124]))
mean(data.matrix(draws_hier[271-125]))
mean(data.matrix(draws_hier[271-123]))
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)])
loo2 <- loo(log_lik)
loo2
print(loo2)
model_hier
View(model_hier)
?Rhat
View(loo2)
loo2$elpd_loo
loo2
loo2$estimates[1]
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
file_name = "suicides_v_income_2.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)])
loo1 <- loo(log_lik)
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
file_name = "suicides_v_income_2.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)])
loo1 <- loo(log_lik)
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
file_name = "suicides_v_income_1.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)])
loo1 <- loo(log_lik)
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
file_name = "suicides_v_income.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)])
loo1 <- loo(log_lik)
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
file_name = "suicides_v_income.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)])
loo1 <- loo(log_lik)
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
file_name = "model_pool_1.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
file_name = "separate_model_1.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
stan_data <- list(y = c(ukdata$suicides100k, usdata$suicides100k, countrydata$suicides100k), x=c(ukdata$wagepercol, usdata$wagepercol, countrydata$wagepercol), N = 123)
file_name = "model_pool.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y = c(ukdata$suicides100k, usdata$suicides100k, countrydata$suicides100k), x=c(ukdata$wagepercol, usdata$wagepercol, countrydata$wagepercol), N = 123)
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
file_name = "model_pool.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y = c(ukdata$suicides100k, usdata$suicides100k, countrydata$suicides100k), x=c(ukdata$wagepercol, usdata$wagepercol, countrydata$wagepercol), N = 123)
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
file_name = "model_pool_1.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y = c(ukdata$suicides100k, usdata$suicides100k, countrydata$suicides100k), x=c(ukdata$wagepercol, usdata$wagepercol, countrydata$wagepercol), N = 123)
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
y1 = ukdata$suicides100k, x1=ukdata$wagepercol
y = c(ukdata$suicides100k, usdata$suicides100k, countrydata$suicides100k)
x=c(ukdata$wagepercol, usdata$wagepercol, countrydata$wagepercol)
93+22+9
file_name = "model_pool_1.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y = c(ukdata$suicides100k, usdata$suicides100k, countrydata$suicides100k), x=c(ukdata$wagepercol, usdata$wagepercol, countrydata$wagepercol), N = 124)
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
#file_name = "separate_model_1.stan"
file_name = "separate_sigma/separate_model_2.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
#file_name = "separate_model_1.stan"
file_name = "separate_sigma/suicides_v_income_2"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
#file_name = "separate_model_1.stan"
file_name = "separate_sigma/suicides_v_income_2"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
#file_name = "separate_model_1.stan"
file_name = "separate_sigma/suicides_v_income_2.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
#file_name = "suicides_v_income.stan"
#file_name = "separate_model_1.stan"
file_name = "separate_sigma/suicides_v_income_cov2.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
library(rstan)
library(shinystan)
library(loo)
#setwd("C:/Users/SopittaT/Desktop/Fall2020/BDA/Project/Data")
#setwd("~/Documents/work/bda/project")
setwd("/m/home/home7/75/ranjitm1/unix/Downloads/bda/suicide_v_income")
ukdata =read.csv('UKdata.csv');
usdata =read.csv('USdata.csv');
countrydata =read.csv('countrydata.csv')
#file_name = "suicides_v_income.stan"
#file_name = "separate_model_1.stan"
file_name = "separate_sigma/suicides_v_income_cov2.stan"
sm_suicide <- rstan::stan_model(file = file_name)
stan_data <- list(y1 = ukdata$suicides100k, x1=ukdata$wagepercol, N1 = length(ukdata$wagepercol), y2 = usdata$suicides100k, x2=usdata$wagepercol, N2 = length(usdata$wagepercol), y3 = countrydata$suicides100k, x3=countrydata$wagepercol, N3 = length(countrydata$wagepercol))
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
model_hier <- rstan::sampling(sm_suicide, data = stan_data, seed = 2,control=list(adapt_delta=0.95))
draws_hier <- as.data.frame(model_hier)
log_lik  <- data.matrix(draws_hier[(length(draws_hier)-123):(length(draws_hier)-1)]) #Works for all models
loo1 <- loo(log_lik)
print(loo1$estimates[1])
